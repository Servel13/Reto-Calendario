<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reto en Pareja ğŸ’™ğŸ’–</title>

  <!-- Firebase SDK (compatibilidad con navegadores sin mÃ³dulos) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #fafafa;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 20px;
    }
    .month-nav {
      margin: 10px 0;
    }
    .month-nav button {
      padding: 8px 14px;
      margin: 0 5px;
      border: none;
      border-radius: 10px;
      background: #444;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      max-width: 900px;
      margin: 20px auto;
      gap: 8px;
    }
    .day {
      border: 1px solid #ccc;
      border-radius: 12px;
      padding: 6px;
      background: white;
      min-height: 90px;
      box-shadow: 0 0 5px #ddd;
    }
    .day-number {
      font-size: 12px;
      color: #666;
      margin-bottom: 2px;
    }
    .icons {
      display: flex;
      justify-content: center;
      gap: 6px;
      font-size: 22px;
      margin-top: 4px;
    }
    .row-label {
      font-size: 10px;
      color: #888;
    }
    .icons span {
      cursor: pointer;
      transition: transform 0.2s, background-color 0.3s;
      border-radius: 50%;
      padding: 4px;
    }
    .icons span:hover {
      transform: scale(1.2);
    }
    .active-blue {
      background-color: rgba(0, 100, 255, 0.25);
      box-shadow: 0 0 6px rgba(0, 100, 255, 0.5);
    }
    .active-pink {
      background-color: rgba(255, 20, 147, 0.25);
      box-shadow: 0 0 6px rgba(255, 20, 147, 0.5);
    }
    .counters {
      margin: 20px auto;
      max-width: 600px;
      background: white;
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 0 10px #ccc;
    }
    .counters div {
      margin: 5px 0;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>ğŸ’ª Reto en Pareja â€” Octubre / Noviembre / Diciembre</h1>

  <div class="month-nav">
    <button id="prev">â¬…ï¸</button>
    <span id="monthName" style="font-weight:bold; font-size:18px;"></span>
    <button id="next">â¡ï¸</button>
  </div>

  <div id="calendar" class="calendar"></div>

  <div class="counters">
    <div>ğŸ’™ <b>Servel</b> â€” ğŸƒâ€â™‚ï¸ <span id="b-ex">0</span> | ğŸ½ï¸ <span id="b-food">0</span> | ğŸ’§ <span id="b-water">0</span></div>
    <div>ğŸ’– <b>Carmen</b> â€” ğŸƒâ€â™€ï¸ <span id="g-ex">0</span> | ğŸ½ï¸ <span id="g-food">0</span> | ğŸ’§ <span id="g-water">0</span></div>
  </div>

  <script>
    // Inicializar Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAuq6Dm4P989aa_63PFcCYHPVpsF7gnpiA",
      authDomain: "reto-calendario.firebaseapp.com",
      projectId: "reto-calendario",
      storageBucket: "reto-calendario.appspot.com",
      messagingSenderId: "1012712540953",
      appId: "1:1012712540953:web:c329e1b5f002a6a7e2d388",
      measurementId: "G-928B2T1JRG"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const months = [
      { name: "Octubre", days: 31 },
      { name: "Noviembre", days: 30 },
      { name: "Diciembre", days: 31 }
    ];
    let currentMonth = 0;

    const calendar = document.getElementById("calendar");
    const monthName = document.getElementById("monthName");

    function renderCalendar() {
      monthName.textContent = months[currentMonth].name;
      calendar.innerHTML = "";

      for (let d = 1; d <= months[currentMonth].days; d++) {
        const div = document.createElement("div");
        div.className = "day";
        div.innerHTML = `
          <div class="day-number">${d}</div>
          <div class="row-label">ğŸ’™ Servel</div>
          <div class="icons" data-person="b" data-day="${d}">
            <span data-type="exercise">ğŸƒâ€â™‚ï¸</span>
            <span data-type="food">ğŸ½ï¸</span>
            <span data-type="water">ğŸ’§</span>
          </div>
          <div class="row-label">ğŸ’– Carmen</div>
          <div class="icons" data-person="g" data-day="${d}">
            <span data-type="exercise">ğŸƒâ€â™€ï¸</span>
            <span data-type="food">ğŸ½ï¸</span>
            <span data-type="water">ğŸ’§</span>
          </div>
        `;
        calendar.appendChild(div);
      }

      loadProgress();
      addClickHandlers();
    }

    function addClickHandlers() {
      calendar.querySelectorAll(".icons span").forEach((icon) => {
        icon.addEventListener("click", async () => {
          const parent = icon.parentElement;
          const person = parent.dataset.person;
          const day = parent.dataset.day;
          const type = icon.dataset.type;
          const colorClass = person === "b" ? "active-blue" : "active-pink";
          const path = `users/${months[currentMonth].name}/${person}/days/${day}/${type}`;
          const refPath = db.ref(path);

          const snapshot = await refPath.get();
          const isActive = snapshot.exists() && snapshot.val().active;

          if (isActive) {
            icon.classList.remove(colorClass);
            refPath.remove();
          } else {
            icon.classList.add(colorClass);
            refPath.set({ active: true });
          }

          updateCounters();
        });
      });
    }

    function loadProgress() {
      calendar.querySelectorAll(".icons span").forEach(async (icon) => {
        const parent = icon.parentElement;
        const person = parent.dataset.person;
        const day = parent.dataset.day;
        const type = icon.dataset.type;
        const colorClass = person === "b" ? "active-blue" : "active-pink";
        const path = `users/${months[currentMonth].name}/${person}/days/${day}/${type}`;
        const refPath = db.ref(path);

        const snapshot = await refPath.get();
        if (snapshot.exists() && snapshot.val().active) {
          icon.classList.add(colorClass);
        }
      });

      updateCounters();
    }

    async function updateCounters() {
      const counters = {
        b: { exercise: 0, food: 0, water: 0 },
        g: { exercise: 0, food: 0, water: 0 },
      };

      for (const person of ["b", "g"]) {
        const refPath = db.ref(`users/${months[currentMonth].name}/${person}/days`);
        const snapshot = await refPath.get();
        if (snapshot.exists()) {
          snapshot.forEach((daySnap) => {
            daySnap.forEach((typeSnap) => {
              if (typeSnap.val().active) {
                counters[person][typeSnap.key]++;
              }
            });
          });
        }
      }

      document.getElementById("b-ex").textContent = counters.b.exercise;
      document.getElementById("b-food").textContent = counters.b.food;
      document.getElementById("b-water").textContent = counters.b.water;
      document.getElementById("g-ex").textContent = counters.g.exercise;
      document.getElementById("g-food").textContent = counters.g.food;
      document.getElementById("g-water").textContent = counters.g.water;
    }

    document.getElementById("prev").addEventListener("click", () => {
      if (currentMonth > 0) currentMonth--;
      renderCalendar();
    });

    document.getElementById("next").addEventListener("click", () => {
      if (currentMonth < months.length - 1) currentMonth++;
      renderCalendar();
    });

    renderCalendar();

<!-- Mensaje de felicitaciÃ³n -->
<div id="felicitacion" style="
  display:none;
  background-color:#ffe6f2;
  color:#d63384;
  font-weight:bold;
  padding:12px;
  border-radius:10px;
  margin:15px auto;
  max-width:500px;
  box-shadow:0 0 10px rgba(255,105,180,0.4);
  animation:fadeIn 0.8s;
">
  ğŸ‰ Â¡Felicidades Carmen! Vas por buen camino ğŸ’–
</div>
    
    // âœ… Verificar si Carmen alcanzÃ³ los 20 puntos
const totalCarmen = counters.g.exercise + counters.g.food + counters.g.water;
const mensaje = document.getElementById("felicitacion");

if (totalCarmen >= 20) {
  mensaje.style.display = "block";
} else {
  mensaje.style.display = "none";
}
    
  </script>
</body>
</html>

